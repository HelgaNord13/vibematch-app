<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Vibe App</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
  </head>

  <body style="font-family: sans-serif; padding: 20px;">
    <h1>Vibe Match</h1>

    <div id="app">Загрузка…</div>

    <script>
      const tg = window.Telegram.WebApp;
      tg.ready();

      const user = tg.initDataUnsafe?.user;

      const questions = [
        {
          id: "depth",
          text: "Тебе важнее глубина или лёгкость?",
          options: [
            { text: "Глубина", value: 7 },
            { text: "Лёгкость", value: 3 }
          ]
        },
        {
          id: "freedom",
          text: "Свобода для тебя — это…",
          options: [
            { text: "Делать, что чувствую", value: 7 },
            { text: "Иметь стабильность", value: 3 }
          ]
        },
        {
          id: "ambition",
          text: "Тебя больше тянет к…",
          options: [
            { text: "Большим целям", value: 7 },
            { text: "Спокойной жизни", value: 3 }
          ]
        }
      ];

      let current = 0;
      let answers = JSON.parse(localStorage.getItem("vibe_answers"));

      if (!answers) {
        answers = {};
        renderQuestion();
      } else {
        showSearchScreen();
      }

      function renderQuestion() {
        const q = questions[current];
        document.getElementById("app").innerHTML = `
          <p><b>${q.text}</b></p>
          ${q.options
            .map(
              (o) =>
                `<button style="margin: 8px 0; width: 100%; padding: 12px;"
                  onclick="answer('${q.id}', ${o.value})">
                  ${o.text}
                </button>`
            )
            .join("")}
        `;
      }

      function answer(id, value) {
        answers[id] = value;
        current++;

        if (current < questions.length) {
          renderQuestion();
        } else {
          localStorage.setItem(
            "vibe_answers",
            JSON.stringify(answers)
          );
          showSearchScreen();
        }
      }

      function showSearchScreen() {
        document.getElementById("app").innerHTML = `
          <p><b>Анкета заполнена</b></p>
          <p>Ищем людей с похожим вайбом…</p>
          <button
            style="margin-top: 20px; width: 100%; padding: 14px;"
            onclick="startMatching()"
          >
            Найти вайб
          </button>
        `;
      }

      function startMatching() {
        // Симулируем 3 других человека
        const others = [
          { name: "Анна", vibe: { depth: 7, freedom: 5, ambition: 6 } },
          { name: "Игорь", vibe: { depth: 6, freedom: 7, ambition: 7 } },
          { name: "Мария", vibe: { depth: 5, freedom: 6, ambition: 5 } }
        ];

        document.getElementById("app").innerHTML = `
          <p><b>Мы подобрали людей с похожим вайбом!</b></p>
          <div id="matches"></div>
        `;

        const container = document.getElementById("matches");
        others.forEach((o) => {
          const div = document.createElement("div");
          div.style.border = "1px solid #ccc";
          div.style.padding = "10px";
          div.style.margin = "8px 0";
          div.style.borderRadius = "8px";
          div.innerHTML = `
            <p><b>${o.name}</b></p>
            <p>Глубина: ${o.vibe.depth}, Свобода: ${o.vibe.freedom}, Амбиции: ${o.vibe.ambition}</p>
            <button style="margin-top: 6px; padding: 8px; width: 100%;" onclick="startCall('${o.name}')">Позвонить</button>
          `;
          container.appendChild(div);
        });
      }

      function startCall(name) {
        document.getElementById("app").innerHTML = `
          <p><b>Созвон с ${name}…</b></p>
          <p>Здесь будет WebRTC-видео или аудио</p>
        `;
      }
    </script>
  </body>
</html>
